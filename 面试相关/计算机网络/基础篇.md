# TCP/IP网络模型有几层？
- 应用层
- 传输层
- 网络层
- 网络接口层
## 应用层（段，segment）
常见协议：
- HTTP（报文，message）
- HTTPS
- Telnet
- DNS
- SMTP
- FTP
## 传输层（包，packet）
1. TCP协议：提供可靠的、面向连接的全双工基于字节流的网络传输协议
	1. 它有许多特性：流量控制，拥塞控制，超时重传
2. UDP协议：用户传输协议

传输层的数据包大小超过MSS（不包括TCP报文头部），就需要将数据包分块。在TCP中，每个分块称为一个TCP段

## 网络层（帧，frame）
最常使用协议为IP协议，IP层会将传输层的报文段作为数据部分，再加上IP报头组成IP报文。如果IP报文大小超过MTU（包括IP报文头部）就会再次进行分片，得到一个即将发送的网络IP报文。

### IP地址
用于主机间的通信，IP地址有两层意义：
- 网络号：标识该IP地址属于哪个子网
- 主机号：标识同一子网下的不同主机

用子网掩码通过位运算得到 IP 地址的网络号和主机号
将子网掩码取反后和IP地址进行位运算，可以得到主机号

### 路由
IP协议的寻址作用是告诉我们去往下一个目的地该朝哪个方向走，路由则是根据【下一个目的地】选择路径
## 网络接口层
生成IP头部，接下来就要交给网络接口层在IP头部加上MAC头部，封装为数据帧发送到网络上

MAC头部是以太网使用的头部，它包含了接收方和发送方的MAC地址等信息，可以通过ZRP协议获取对方的MAC地址

# 键入网址到网页显示，期间发生了什么？
%%首先本机应用层将请求送达本机的传输层，本机根据本地DNS缓存查询网址对应的IP地址，如果没有，依次访问根DNS，权威DNS寻找IP地址。生成HTTP请求，根据TCP协议将请求数据装进TCP段，发送给网络层。网络层根据IP协议，加入IP报文头，报文头里包括目的地的IP地址，IP协议将IP报文送至服务器，服务器通过一个接口接收到信息，将信息传给IP层解析信息，再传给传输层，建立连接。通过三次握手建立连接后，客户端向服务端发送HTTP报文，客户端接收到报文后解析数据，渲染页面，并通过长连接继续获取资源%%
## 1.解析URL
解析出协议（https）、域名（www.baidu.com) 、端口、路径
## 2.DNS解析
根据域名获得目标服务器的IP地址
首先在浏览器缓存查找-》操作系统缓存-》路由器缓存-》ISP的DNS服务器（根域名服务器-》顶级域名服务器-》权威服务器 ，返回IP地址
找到IP地址后，将传输工作交给操作系统中的协议栈
## 3.建立TCP连接
客户端通过三次握手与服务器建立三次握手
如果是https，还需要进行TLS握手
## 4.发送HTTP请求
HTTP报文和数据一同放进TCP段，交给网络层处理
## 5.远程定位——IP
TCP报文段打包放进IP报文，在网络中传播
## 6.两点传输——MAC
不知道对方的MAC，就在以太网发送ARP广播（ARP协议）
本地会有ARP缓存暂时储存映射关系
## 7.出口——网卡
此时HTTP报文已经有TCP头部，IP头部，MAC头部，组成完整的网络包
网卡驱动获取到网络包，将其复制到网卡内的缓存区中，接着在开头加上报头和起始帧分界符，在末尾加上用于检测的帧校验序列
网卡将包转为电信号通过网线发送出去
## 8.送别者——交换机
交换机工作在MAC层，被称为二层网络设备
他没有MAC地址，将收到的信息全部放入缓存中，根据MAC地址表将信号转发到对应的端口
地址表中保存交换机端口号和MAC地址的映射信息
如果没有找到，发送到所有端口
## 9.出境大门——路由器
路由器基于IP设计，是三层网络地址，每个端口都有MAC地址和IP地址

路由器的操作：
- 接收操作
	- 电信号到达网络接口部分，路由器中的模块会将电信号转化为熟悉信号，通过包末尾的FCS进行错误校验
	- 没问题检查MAC头部中的接收方MAC地址，只保留符合自己MAC地址的
- 确定输出端口
	- 完成包接受操作，路由器去掉网络包的MAC头部，根据IP头部进行转发操作
			- 查询路由表确定转发目标
	- 找不到选择默认路由
- 发送操作
	- 如果网关是一个NULL，说明到达目的地
	- 如果是IP地址，还需要路由器继续转发
		- 继续通过ARP协议确定MAC地址，将其作为网络包的MAC地址。（当然路由器也有ARP缓存）

## 10.服务器处理请求
层层解析协议，判断是否符合要求，最终也按照上面的流程，生成

## 11.连接关闭


